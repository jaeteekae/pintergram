{% extends "base.html" %}
{% load staticfiles %}
{% block newsfeed-content %}

{% if latest_post_list %}
    {% for post, tag_group in zipped_lists %}
    
        <div class="post pn" data-postid='{"id":"{{ post.id }}"}'>
            
            <div class="credit" >
                
                <img class="post-avatar" src="{% static 'newsfeed/img/ui-danro.jpg' %}">
                <div class="username monofur-font">{{ post.user_id }}</div>
                <div class="timestamp">{{ post.timestamp }}</div>
            </div>

            <a href="{% url 'newsfeed:single_post' post.id %}" class="post-link">
                <!--
	            <img class="post-image"src="https://placekitten.com/g/400/200">
                -->
                {% if post.image_path %}
                <img class="post-image"src="/media/{{ post.image_path }}" width="200" height="100"/>
                {% endif %}
	        </a>

            <div class="title monofur-font">
                <a href="{% url 'newsfeed:single_post' post.id %}" class="post-link">
                    {{ post.post_title }}
                </a>
    
            </div>

            <div class="caption">
                {{ post.post_text }}
            </div>
            <div class="divider" >
	        	<!-- <img src="{% static 'newsfeed/img/navbar2.png' %}" class="divider"> -->
	        	<div class="gradient">test</div>
	        	<!-- <div class="divider" style="background-image: url(/static/newsfeed/img/navbar2.png);"></div> -->
	        </div>


            <div class="upvotes">
                10,000 upvotes &nbsp;&nbsp;  &nbsp;&nbsp;
            {% if tag_group %}
            
                tags: {% for tag in tag_group %}&#35;{{ tag.tag }}&nbsp;&nbsp;{% endfor %}
            
            {% endif %} 
                        
                <div class="upvote-button">&#9734</div>
            </div>
            
        </div>
    

    {% endfor %}
    
{% else %}
    <p>No posts are available.</p>
{% endif %}
{% endblock %}




{% block new-post-mod %}



{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}


<!-- <div class="new-post pn"> -->
	<form action="create_post" method="post" enctype="multipart/form-data">
	
<!-- 	
		<div class="quarter" >
			<img class="crossed" id="img-preview-spot" src="{% static 'newsfeed/img/cross-blank.png' %}">
		</div> -->
		
		{% csrf_token %}
        <div class="quarter" >
			<input type="file" name="post-image" id="post-image" accept="image/*" >
        </div>
        <div class="threequarter all-inputs">
	    <input type="text" name="post_title" id="post_title" placeholder="Title your creation" class="new-post-input title"/>
	    <input type="text" name="post_text"  id="post_text"  placeholder="Caption" class="new-post-input text"/>
		<input type="text" name="tags"       id="tags"       placeholder="Tags (separate by commas)" class="new-post-input text"/> <!-- tags separated by commas -->
		<input type="submit" value="create post" class="new-post-button"/>
        </div>
		

	</form>
<!-- </div> -->
<!-- 
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script src="{% static 'newsfeed/js/jquery.js' %}"></script> -->

<script type="text/javascript">




// uploads images
// $("#post-image").change(function(e) {

// 	var src = $('.file-preview-image').attr('src');
// 	$('.img-preview-spot').attr('src') = src;

//     for (var i = 0; i < e.originalEvent.srcElement.files.length; i++) {

//         var file = e.originalEvent.srcElement.files[i];

//         var img = document.createElement("img");
//         var reader = new FileReader();
//         reader.onloadend = function() {
//              img.src = reader.result;
//         }
//         reader.readAsDataURL(file);
//         $("#post-image").after(img);
//     }
// });


setInterval(function(){
    $.ajax({ url: "posts", success: function(data){
        
        console.log(data);
        console.log($("#main-content-stream").first());
        var currentId = $("#main-content-stream div").first().data("postid").id;
        console.log(currentId);
            
        if (data) {
            
            for (var i = 0; i < data.length; i++) {
                var post = data[i];
                console.log(post);
                if (Number(post["id"]) > Number(currentId)) {
                    console.log("in addPostIndex with id = "+post["id"]);
                }

            }
        }

    }, dataType: "json"});
}, 5000);



function addPostIndex(data) {
    console.log("in addPostIndex with id = "+data.id);
    if (data) {
        var stream = document.getElementById("main-content-stream");
        var recentChild = stream.firstChild();

        var newPost = document.createElement("div");
        newPost.className = 
        newPost.setAttribute("data-postid", '{"id":'+data.id+'"}');
//////
        var credit = document.createElement("div");
        credit.className = "credit";


        var postAvatar = document.createElement("img");
        postAvatar.src = "{% static 'newsfeed/img/ui-danro.jpg' %}"
        postAvatar.className = "post-avatar";

        var username = document.createElement("div");
        var usernameText = document.createTextNode(data.username);
        username.appendChild(usernameText);
        username.className = "username monofur-font"

        var timestamp = document.createElement("div");
        var timestampText = document.createTextNode(data.timestamp);
        timestamp.appendChild(timestampText);
        timestamp.className = timestamp;

        credit.appendChild(postAvatar);
        credit.appendChild(username);
        credit.appendChild(timestamp);
        newPost.appendChild(credit);

//////

        var link = document.createElement("a");
        link.className = "post-link";
        
        if (data.image_path) {
            var img = document.createElement("img");
            img.className = "post-image";
            img.src = "/media/"+data.image_path;
            img.style.height = "100";
            img.style.width = "100";
            link.appendChild(img);

        }
        newPost.appendChild(link);

///////
        var title = document.createElement("div");
        title.className = "title monofur-font";
        var titleLink = document.createElement("a");
        titleLink.className = "post-link";
        
        var titleLinkText = document.createTextNode(data.post_title);
        titleLink.appendChild(titleLinkText);
        title.appendChild(titleLink);
        newPost.appendChild(title);

///////

        var caption = document.createElement("div");
        caption.className = "caption";
        var captionText = document.createTextNode(data.post_text);
        caption.appendChild(captionText);
        newPost.appendChild(caption);

/////
        var divider = document.createElement("div");
        divider.className = "divider";
        newPost.appendChild(divider);

//////
        var upvotes = document.createElement("div");
        upvotes.className = "upvotes";
        if (data.tags) {

        }
        var upvotesText = document.createTextNode("10,000 upvotes &nbsp;&nbsp;  &nbsp;&nbsp;");
        upvotes.appendChild(upvotesText);

        var upvoteButton = document.createElement("div");
        upvoteButton.className = "upvote-button";

        var upvoteButtonText = document.createTextNode("&#9734");
        upvoteButton.appendChild(upvoteButtonText);
        upvotes.appendChild(upvoteButton);
        newPost.appendChild(upvotes);

        newPost.insertBefore(recentChild);

    }

}


</script>

{% endblock %}